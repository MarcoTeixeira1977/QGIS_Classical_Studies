# 8. Module: Rasters
We’ve used rasters for digitizing before, but raster data can also be used directly. In this module, you’ll see how it’s done in QGIS.

## 8.1. Lesson: Working with Raster Data
Raster data is quite different from vector data. Vector data has discrete features with geometries constructed out of vertices, and perhaps connected with lines and/or areas. Raster data, however, is like any image. Although it may portray various properties of objects in the real world, these objects don’t exist as separate objects. Rather, they are represented using pixels with different values.

During this module you are going to use raster data to supplement your existing GIS analysis.

**The goal for this lesson:** To learn how to work with raster data in QGIS.

### 8.1.1. ![basic](https://github.com/Toletum-Network/AutumnSchool_2020/blob/master/Icons/basic.png) Follow Along: Loading Raster Data
Raster data can be loaded with the same methods we used for vector data. However we suggest to use the **``Browser``** Panel.

1. Open the **``Browser Panel``** and expand the exercise_data/raster folder.
2. Load all the data in this folder:

> * ~3320C_2010_314_RGB_LATLNG.tif~
> * ~3320D_2010_315_RGB_LATLNG.tif~
> * ~3420B_2010_328_RGB_LATLNG.tif~
> * ~3420C_2010_327_RGB_LATLNG.tif~

You should see the following map:

![8.1.1]() 

There we have it - four aerial images covering our study area.

### 8.1.2. ![basic](https://github.com/Toletum-Network/AutumnSchool_2020/blob/master/Icons/basic.png) Follow Along: Create a Virtual Raster
Now as you can see from this, your solution layer lies across all four images. What this means is that you are going to have to work with four rasters all the time. That’s not ideal. It would be better to have one file to work with.

Luckily, QGIS allows you to do exactly this, and without needing to actually create a new raster file. You can create a **Virtual Raster**. This is also often called a _Catalog_, which explains its function. It’s not really a new raster. Rather, it is a way to organize your existing rasters into one catalog: one file for easy access.

To make a catalog we will use the **``Processing ‣ Toolbox``**.

1. Open the **``Build virtual raster``** algorithm from the **``GDAL ‣ Raster miscellaneous``**;
2. In the dialog that appears, click on the **``…``** button next to the **``Input layers``** parameter and check all the layers or use the **``Select All``** button;
3. Uncheck **``Place each input file into a separate band``**. Notice the text field below. What this dialog is actually doing is that it is writing that text for you. It is a long command that QGIS is going to run.

**``! Note``**
Keep in mind that you can copy and paste the text in the _OSGeo Shell_ (Windows user) or _Terminal_ (Linux and OSX users) to run the command. You can also create a script for each GDAL command. This is very handy when the procedure is taking a long time or when you want to schedule specific tasks. Use the **``Help``** button to get more help on the syntax of the command.

4. Finally click on **``Run``**.

**``! Note``**
As you know from the previous modules, **``Processing``** creates temporary layers by default. To save the file click on the **``…``** button.

![8.1.2]()

You can now remove the original four rasters from the **``Layers``** Panel and leave only the output virtual catalog raster.

#### 8.1.3. In Conclusion
QGIS makes it easy to include raster data into your existing projects.

### 8.1.4. What’s Next?
Next, we’ll use raster data that isn’t aerial imagery, and see how symbolization is useful in the case of rasters as well.


## 8.2. Lesson: Changing Raster Symbology
Not all raster data are aerial photos. There are many other forms of raster data, and in many of those cases, it is essential to symbolize the them so that they becomes properly visible and useful.

The goal for this lesson: To change the symbology for a raster layer.

### 8.2.1. ![basic](https://github.com/Toletum-Network/AutumnSchool_2020/blob/master/Icons/basic.png) Try Yourself
1. Use the **``Browser``** Panel to load ~srtm_41_19.tif~, found under ~exercise_data/raster/SRTM/~
2. Zoom to the extent of this layer by right-clicking on it in the **``Layers panel``** and selecting **``Zoom to Layer``**.

This dataset is a _Digital Elevation Model (DEM)_. It is a map of the elevation (altitude) of the terrain, allowing us to see where the mountains and valleys are, for example.

While each pixel of the dataset of the previous section contained color information, in a DEM, each pixel contains elevation values.

Once the DEM is loaded, you will notice that it is a grayscale representation:

![8.2.1}()

QGIS has automatically applied a stretch to the pixel values og the image for visualization purposes, and we will learn more about how this works as we continue.

### 8.2.2. ![basic](https://github.com/Toletum-Network/AutumnSchool_2020/blob/master/Icons/basic.png) Follow Along: Changing Raster Layer Symbology
You have two different options to change the raster symbology:

1. Within the **``Layer Properties``** dialog, by right-clicking on the layer in the Layer tree and selecting the **``Properties``** option. Then switch to the **``Symbology``** tab
2. By clicking on the ![symbology](https://github.com/Toletum-Network/AutumnSchool_2020/blob/master/Icons/symbology.png)_Open the Layer Styling panel_ button right above the **``Layers``** panel (shortcut F7). This will open the **``Layer Styling``** panel, where you can switch to the ![symbology](https://github.com/Toletum-Network/AutumnSchool_2020/blob/master/Icons/symbology.png)_Symbology_ tab.

Choose the method you prefer to work with.

### 8.2.3. ![basic](https://github.com/Toletum-Network/AutumnSchool_2020/blob/master/Icons/basic.png) Follow Along: Singleband gray
When you load a raster file, if it is not a photo image like the ones of the previous section, the default style is set to a grayscale gradient.

Let’s explore some of the features of this renderer.

![8.2.3 A]()

The default **``Color gradient``** is set to _Black to white_, meaning that low pixel values are black and while high values are white. Try to invert this setting to _White to black_ and see the results.

Very important is the **``Contrast enhancement``** parameter: by default it is set to _Stretch to MinMax_ meaning that the pixel values are stretched to the minimum and maximum values.

Look at the difference with the enhancement (left) and without (right):

![8.2.3 B &C]()

But what are the minimum and maximum values that should be used for the stretch? The ones that are currently under **``Min / Max Value Settings``**. There are many ways to calculate the minimum and maximum values and use them for the stretch:

1. **User Defined**: you enter the **``Min``** and **``Max``** values manually
2. **Cumulative count cut**: this is useful when you have some extreme low or high values. It _cuts_ the _2%_ (or the value you choose) of these values
3. **Min / max**: the _Real_ or _Estimated_ minimum and maximum values of the raster
4. **Mean +/- standard deviation**: the values will be calculated according to the mean value and the standard deviation

### 8.2.4. ![basic](https://github.com/Toletum-Network/AutumnSchool_2020/blob/master/Icons/basic.png) Follow Along: Singleband pseudocolor
Grayscales are not always great styles for raster layers. Let’s try to make the DEM more colorful.

* Change the **``Render type``** to **``Singleband pseudocolor``**. If you don’t like the default colors loaded, select another **``Color``** ramp
* Click the **``Classify``** button to generate a new color classification
* If it is not generated automatically click on the **``OK``** button to apply this classification to the DEM

![8.2.4 A]()

You’ll see the raster looking like this:

![8.2.4 B]()

This is an interesting way of looking at the DEM. You will now see that the values of the raster are again properly displayed, going from blue for the lower areas to red for the higher ones.

### 8.2.5. Follow Along: Changing the transparency
Sometimes changing the transparency of the whole raster layer can help you to see other layers covered by the raster itself and better understand the study area.

To change the transparency of the whole raster switch to the **``Transparency``** tab and use the slider of the **``Global Opacity``** to lower the opacity:

![8.2.5 A]()

More interesting is changing the transparency for some pixel values. For example in the raster we used you can see a homogeneous color at the corners. To set these pixels as transparent, go to **``Custom Transparency Options``** in the **``Transparency``** tab.

* By clicking on the ![signPlus](https://github.com/Toletum-Network/AutumnSchool_2020/blob/master/Icons/symbologyAdd.png)_Add values manually_ button, you can add a range of values and set their transparency percentage
* For single values the ![contextHelp](https://github.com/Toletum-Network/AutumnSchool_2020/blob/master/Icons/mActionContextHelp.png)_Add values from display_ button is more useful
* Click on the ![contextHelp](https://github.com/Toletum-Network/AutumnSchool_2020/blob/master/Icons/mActionContextHelp.png)_Add values from display_ button. The dialog disappears, and you can interact with the map.
* Click on on the homogeneous color in a corner of the DEM
* You will see that the transparency table will be filled with the clicked values:

![8.2.5 B]()

Click on **``OK``** to close the dialog and see the changes.


![8.2.5 C]()

See? The corners are now 100% transparent.

### 8.2.6. In Conclusion
These are some the basic functions to get you started with raster symbology. QGIS also gives you many other options, such as symbolizing a layer using paletted/unique values, representing different bands with different colors in a multispectral image, or making an automatic hillshade effect (useful only with DEM raster files).

### 8.2.7. Reference
The SRTM dataset was obtained from http://srtm.csi.cgiar.org/

### 8.2.8. What’s Next?
Now that we can see our data displayed properly, let’s investigate how we can analyze it further.
